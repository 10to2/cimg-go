version: 2.1

orbs:
  sonar: hubci/sonar@1.0.0
  cimg: circleci/cimg@dev:32d2ce0b1cd2b362723d32b35eed5a13353d5800

workflows:
  main:
    jobs:
      - cimg/gen-dockerfiles
      - cimg/build-and-deploy:
          name: "Push to Staging"
          publish-branch: test
          docker-namespace: ccitest
          docker-repository: go
          context: cimg-publishing
          requires:
            - cimg/gen-dockerfiles
